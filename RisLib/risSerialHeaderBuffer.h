#pragma once
/*==============================================================================
Serial header buffer
=============================================================================*/

//******************************************************************************
//******************************************************************************
//******************************************************************************

#include "risByteBuffer.h"

//******************************************************************************
//******************************************************************************
//******************************************************************************

namespace Ris
{

//******************************************************************************
//******************************************************************************
//******************************************************************************
// This class encalsulates a buffer of bytes that is used to detect serial 
// communications message headers. It is a shift register of bytes, it shifts
// up. The top element is the oldest and the bottom element is the most recent.

class SerialHeaderBuffer
{
public:
   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Members.

   char    mX;         // Input value
   int     mSize;      // Array size
   int     mIndex;     // Index of bottom element
   int     mCount;     // Number of occupied elements
   bool    mValid;     // Valid
   char*   mArray;     // Value array

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // members.

   // Constructors.
   SerialHeaderBuffer();
   SerialHeaderBuffer(int aSize);
  ~SerialHeaderBuffer();
   void reset(); 

   // Allocate memory and initialize.
   void initialize(int aSize);
   // Initialize, but reuse memory.
   void reinitialize();
   // Deallocate memory.
   void finalize();
   // Show.
   void show();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Shift up and put input value at the bottom.
   void put(char aX) { shiftUp(aX); }

   // Shift up and put input value at the bottom.
   void shiftUp(char aX);

   // Set the bottom value.
   void setBottom(char aX);

   // Get value.
   char get(int    aIndex);
   char getTop();
   char getBottom();

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Copy the entire header buffer to a byte buffer.
   void copyTo(Ris::ByteBuffer* aBuffer);

   //***************************************************************************
   //***************************************************************************
   //***************************************************************************
   // Methods.

   // Return true if the buffer is full.
   bool isFull() {return mCount==mSize;}

};

//******************************************************************************
//******************************************************************************
//******************************************************************************
}//namespace

